# 전역 상태나 캐시는 언제 유지되고 언제 리셋되는가?

Redux, recoil, react-query, swr 의 전역 상태나 캐시는 언제 유지되고 언제 파괴될까?

다음과 같은 경우에 웹 브라우저는 페이지를 새로 실행하므로 전역변수나 캐시는 모두 초기화 상태가 된다. 웹앱을 종료시켰다 재실행하는 것과 동일한 효과가 발생한다:

- 사용자가 URL 입력창에 URL을 입력했을 때
  - 동일한 URL이라도 URL 입력창에서 엔터키를 치면 리로드와 동일한 효과가 발생한다
- 새로고침(리로드, reload) 버튼을 클릭했을 때
- 탭을 복재하면 새로 생긴 탭에서 웹앱은 새로 시작한다

## \<a> 를 클릭했을 때

`<a href="...">...</a>` 를 클릭하여 새로운 페이지로 이동할 때 기존 웹앱의 환경은 모두 사라지고 새로운 페이지가 실행될 것으로 예상된다. 그러나, 브라우저나 디바이스 환경에 따르다.

- 기존 페이지 환경은 사라지고 새로운 페이지로 초기화
  - PC(데스크탑)에서 크롬, 파이어폭스
- 기존 페이지 환경이 유지되어 새로운 페이지를 보고 돌아와도 기존 페이지의 전역/캐시 상태가 유지됨
  - PC(데스크탑)에서 사파리
  - 모바일(아이폰): 크롬, 파이어폭스, 사파리
  - 모바일(안드로이드): 확인 못함

## \<Link> 를 클릭했을 때

Next.js 의 `<Link>`는 클라이언트의 상태를 유지하면서 라우트, 또는 페이지 이동을 할 수 있게 해준다. (`Client-side transitions between routes`)
따라서, `<Link href="..."> ... </Link>`를 클릭했을 때 전역/캐시 상태가 유지되면서 새로운 페이지를 로딩하게 된다. 따라서 다시 뒤로 돌아갔을 때 이전 페이지의 바로 이전 상태가 유지된다.

단, href props 에 지정한 URL이 다른 사이트인 경우에는 `<a>` 와 동일한 결과를 보여주기도 한다.

- 기존 페이지 환경을 유지하면서 새로운 페이지 로딩(렌더링)
  - path를 사용했거나 동일한 사이트 URL인 경우 모든 브라우저는 기존 환경을 유지
  - 모바일용 크롬, 파이어폭스, 사파리, 그리고 PC용 사파리는 다른 사이트 URL이라도 기존 환경을 유지한다
- 기존 페이지 환경이 사라지고 새로운 페이지로 초기화
  - Url 이 다른 사이트인 경우

## 브라우저별 전역/캐시 상태 유지

크롬, 파이어폭스(PC)
| | path | same site | other site |
| --- | --- | --- | --- |
| Link | O | O | X |
| a | X | X | X |

사파리(PC)
| | path | same site | other site |
| --- | --- | --- | --- |
| Link | O | O | O |
| a | O | O | O |

크롬, 파이어폭스, 사파리(모바일)

|      | path | same site | other site |
| ---- | ---- | --------- | ---------- |
| Link | O    |           | O          |
| a    | O    |           | O          |
